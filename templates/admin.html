{% extends "base.html" %}

{% block title %}–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - SaveVillage{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h2>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
        <div style="display: flex; gap: 1rem;">
            <a href="{{ url_for('admin_shop') }}" class="btn btn-primary">üõí –ú–∞–≥–∞–∑–∏–Ω</a>
            <a href="{{ url_for('chat') }}" class="btn btn-secondary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —á–∞—Ç</a>
        </div>
    </div>

    <!-- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="admin-section">
        <h3>‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <form id="createUserForm" class="admin-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="newUsername">–õ–æ–≥–∏–Ω</label>
                    <input type="text" id="newUsername" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">–ü–∞—Ä–æ–ª—å</label>
                    <input type="text" id="newPassword" required>
                </div>
                <div class="form-group">
                    <label for="newRole">–†–æ–ª—å</label>
                    <select id="newRole">
                        <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                        <option value="moderator">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </form>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="admin-section">
        <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
        <div class="users-table">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–õ–æ–≥–∏–Ω</th>
                        <th>–†–æ–ª—å</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    {% for user in users %}
                    <tr data-user-id="{{ user.id }}">
                        <td>{{ user.id }}</td>
                        <td>
                            <div class="table-user">
                                <span class="user-avatar-small">{{ user.username[0].upper() }}</span>
                                {{ user.username }}
                            </div>
                        </td>
                        <td>
                            {% if user.is_creator() %}
                            <span class="role-badge role-creator">{{ user.role }}</span>
                            {% else %}
                            <select class="role-select" onchange="changeRole({{ user.id }}, this.value)">
                                <option value="user" {% if user.role == 'user' %}selected{% endif %}>user</option>
                                <option value="moderator" {% if user.role == 'moderator' %}selected{% endif %}>moderator</option>
                            </select>
                            {% endif %}
                        </td>
                        <td>
                            {% if user.is_muted %}
                            <span class="status-badge status-muted">üîá –ú—É—Ç</span>
                            {% else %}
                            <span class="status-badge status-active">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span>
                            {% endif %}
                        </td>
                        <td>{{ user.last_seen.strftime('%d.%m.%Y %H:%M') }}</td>
                        <td class="table-actions">
                            {% if not user.is_creator() %}
                            <button class="btn-icon btn-danger" onclick="deleteUser({{ user.id }}, '{{ user.username }}')" title="–£–¥–∞–ª–∏—Ç—å">
                                üóëÔ∏è
                            </button>
                            {% else %}
                            <span class="text-muted">‚Äî</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="admin-section">
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-info">
                    <span class="stat-value">{{ users|length }}</span>
                    <span class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üü¢</div>
                <div class="stat-info">
                    <span class="stat-value">{{ users|selectattr('last_seen')|list|length }}</span>
                    <span class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üîá</div>
                <div class="stat-info">
                    <span class="stat-value">{{ users|selectattr('is_muted')|list|length }}</span>
                    <span class="stat-label">–ó–∞–º—É—á–µ–Ω–æ</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
{% endblock %}